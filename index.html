<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  body { margin:0; overflow:hidden; background:#87ceeb; }
  canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
// /**/ Cat Fortress 2 - Stacked Floors & Stairs 🐾

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// player
const player = { x:100, y:100, w:32, h:32, dy:0, onGround:false, dir:1 };

// gun emoji
const gunEmoji = '🔫';

// bullets
const bullets = [];

// images
const floorImg = new Image();
floorImg.src = 'floor.png'; // 512x127
const stairImg = new Image();
stairImg.src = 'stairs.png'; // 40x32

// floors & stairs setup
const floors = [];
const stairs = [];
const floorW = 120;
const floorH = 32;
const stairW = 40;
const stairH = 32;
const stairOffsetX = 35;
const floorGap = 150; // vertical spacing between floors

const numFloors = 3;
for(let i=0;i<numFloors;i++){
  let fy = canvas.height - floorH - i*floorGap;
  floors.push({x:0, y:fy, w:floorW, h:floorH});

  // add stairs to next floor (skip top floor)
  if(i<numFloors-1){
    stairs.push({x:floors[i].x, y:fy - stairH, w:stairW, h:stairH});
    stairs.push({x:floors[i].x + stairOffsetX, y:fy - stairH*2, w:stairW, h:stairH});
  }
}

// keyboard
const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

// mouse
let mouseDown=false;
document.addEventListener('mousedown', ()=>mouseDown=true);
document.addEventListener('mouseup', ()=>mouseDown=false);

let mouseX=0, mouseY=0;
document.addEventListener('mousemove', e=>{mouseX=e.clientX; mouseY=e.clientY;});

// physics
const gravity = 0.5;

// game loop
function update(){
  // horizontal movement
  if(keys['a']) { player.x -=5; player.dir=-1; }
  if(keys['d']) { player.x +=5; player.dir=1; }

  // jump
  if(keys[' '] && player.onGround){ player.dy=-12; player.onGround=false; }

  // shift noclip through stairs/floors
  const noclip = keys['shift'];

  // vertical movement
  player.dy += gravity;
  player.y += player.dy;

  // floor collision
  player.onGround=false;
  floors.forEach(f=>{
    if(!noclip && player.y + player.h > f.y && player.y + player.h < f.y + f.h + 10 &&
       player.x + player.w > f.x && player.x < f.x + f.w){
      player.y = f.y - player.h;
      player.dy=0;
      player.onGround=true;
    }
  });

  // stairs collision with a small top gap
  stairs.forEach(st=>{
    if(!noclip &&
       player.x + player.w > st.x && player.x < st.x + st.w &&
       player.y + player.h > st.y && player.y + player.h < st.y + st.h + 10){
         player.y = st.y - player.h + 2; // small gap at top
         player.dy=0;
         player.onGround=true;
       }
  });

  // bullets
  bullets.forEach((b,i)=>{
    b.x += b.dir*10;
    if(b.x<0 || b.x>canvas.width) bullets.splice(i,1);
  });

  // shooting
  if(mouseDown){
    bullets.push({x:player.x+player.w/2, y:player.y+player.h/2, dir:player.dir});
  }
}

// draw loop
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw floors
  floors.forEach(f=>{
    for(let i=0;i<canvas.width;i+=f.w){
      ctx.drawImage(floorImg, i, f.y, f.w, f.h);
    }
  });

  // draw stairs
  stairs.forEach(st=>{
    ctx.drawImage(stairImg, st.x, st.y, st.w, st.h);
  });

  // draw bullets
  bullets.forEach(b=>{
    ctx.fillStyle='black';
    ctx.fillRect(b.x,b.y,5,5);
  });

  // draw player
  ctx.font = player.h + "px serif";
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  ctx.fillText('🐱', player.x+player.w/2, player.y+player.h/2);

  // draw gun
  ctx.textAlign = player.dir>0 ? 'left':'right';
  ctx.fillText(gunEmoji, player.x + (player.dir>0 ? player.w : 0), player.y+player.h/2);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

// resize canvas
window.addEventListener('resize', ()=>{
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  floors.forEach((f,i)=>{
    f.y = canvas.height - floorH - i*floorGap;
  });
  stairs.forEach((st,i)=>{
    if(i<stairs.length) st.y = floors[Math.floor(i/2)].y - stairH*(i%2+1);
  });
});

</script>
</body>
</html>