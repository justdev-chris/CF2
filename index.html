<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  body { margin: 0; overflow: hidden; background: #a0d8f0; }
  canvas { display: block; background: #a0d8f0; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = 800;
canvas.height = 400;

// Images
const floorImg = new Image();
floorImg.src = 'floor.png'; // 512x127
const stairsImg = new Image();
stairsImg.src = 'stairs.png'; // 40x32

// Player
const player = {
    x: 100,
    y: 300,
    width: 32,
    height: 32,
    vy: 0,
    speed: 3,
    jumping: false,
    emoji: 'ðŸ˜º'
};

// Gravity
const gravity = 0.6;
const jumpStrength = -12;

// Floor & stairs setup
const platforms = [
    {x: 0, y: 350, width: canvas.width, height: 32, img: floorImg, repeat: true}
];

const stairs = [
    {x: 200, y: 318, width: 40, height: 32},
    {x: 240, y: 286, width: 40, height: 32},
    {x: 280, y: 254, width: 40, height: 32}
];

// Input
const keys = {};
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// Collision helper
function rectIntersect(r1, r2) {
    return !(r2.x > r1.x + r1.width || 
             r2.x + r2.width < r1.x || 
             r2.y > r1.y + r1.height ||
             r2.y + r2.height < r1.y);
}

// Game loop
function update() {
    // Horizontal movement
    if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
    if (keys['ArrowRight'] || keys['d']) player.x += player.speed;

    // Jump
    if ((keys['ArrowUp'] || keys['w'] || keys[' ']) && !player.jumping) {
        player.vy = jumpStrength;
        player.jumping = true;
    }

    // Gravity
    player.vy += gravity;
    player.y += player.vy;

    // Collision with stairs (smooth stepping)
    let onPlatform = false;
    for (let stair of stairs) {
        const playerRect = {...player, y: player.y + player.vy};
        const stairRect = {...stair};
        if (rectIntersect(playerRect, stairRect)) {
            // Snap player to stair top
            if (player.y + player.height <= stair.y + stair.height) {
                player.y = stair.y - player.height;
                player.vy = 0;
                player.jumping = false;
                onPlatform = true;
            }
        }
    }

    // Collision with floor
    for (let plat of platforms) {
        if (
            player.x + player.width > plat.x &&
            player.x < plat.x + plat.width &&
            player.y + player.height > plat.y &&
            player.y + player.height < plat.y + plat.height
        ) {
            player.y = plat.y - player.height;
            player.vy = 0;
            player.jumping = false;
            onPlatform = true;
        }
    }

    // If falling off
    if (!onPlatform && player.y + player.height < canvas.height) {
        player.jumping = true;
    } else if (player.y + player.height > canvas.height) {
        player.y = canvas.height - player.height;
        player.vy = 0;
        player.jumping = false;
    }

    draw();
    requestAnimationFrame(update);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw floor (repeating)
    for (let plat of platforms) {
        if (plat.repeat) {
            const pattern = ctx.createPattern(plat.img, 'repeat-x');
            ctx.fillStyle = pattern;
            ctx.fillRect(plat.x, plat.y, plat.width, plat.height);
        } else {
            ctx.drawImage(plat.img, plat.x, plat.y, plat.width, plat.height);
        }
    }

    // Draw stairs
    for (let stair of stairs) {
        ctx.drawImage(stairsImg, stair.x, stair.y, stair.width, stair.height);
    }

    // Draw player emoji
    ctx.font = player.width + "px Arial";
    ctx.fillText(player.emoji, player.x, player.y + player.height);
}

// Start loop when images are loaded
floorImg.onload = () => {
    stairsImg.onload = () => {
        update();
    };
};
</script>
</body>
</html>