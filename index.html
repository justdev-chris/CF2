<!-- Cat Fortress 2 ðŸ¾ -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background-color: #a0d8f1;
  }
  canvas {
    display: block;
    background-color: #a0d8f1;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
// /**/ Cat Fortress 2 by lil catboy rawr~ ðŸ¾

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

const gravity = 0.5;

// /**/ Floor
const floorImg = new Image();
floorImg.src = "floor.png"; // 512x127
const floorHeight = 60; // scaled height

const floors = [
  {x:0, y:canvas.height-floorHeight, width:canvas.width, height:floorHeight}
];

// /**/ Stairs
const stairImg = new Image();
stairImg.src = "stairs.png"; // 40x32
const stairs = [
  {x:200, y:canvas.height-92, width:40, height:32},
  {x:240, y:canvas.height-124, width:40, height:32},
  {x:280, y:canvas.height-156, width:40, height:32}
];

// /**/ Player (cat emoji)
const player = {
  x: 50,
  y: canvas.height-80,
  width: 32,
  height: 32,
  dx: 0,
  dy: 0,
  speed: 3,
  jumpPower: 10,
  onGround: false
};

// /**/ Collision helper
function checkCollision(rect1, rect2){
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

// /**/ Game loop
function update() {
  player.dx = 0;
  if(keys["ArrowLeft"] || keys["a"]) player.dx = -player.speed;
  if(keys["ArrowRight"] || keys["d"]) player.dx = player.speed;

  player.dy += gravity;
  player.x += player.dx;
  player.y += player.dy;

  player.onGround = false;

  // /**/ Floor collisions
  for(const f of floors){
    if(checkCollision(player, f) && player.dy >= 0){
      player.y = f.y - player.height;
      player.dy = 0;
      player.onGround = true;
    }
  }

  // /**/ Stairs collisions
  for(const s of stairs){
    if(checkCollision(player, s) && player.dy >= 0){
      player.y = s.y - player.height;
      player.dy = 0;
      player.onGround = true;
    }
  }

  if((keys["ArrowUp"] || keys["w"] || keys[" "]) && player.onGround){
    player.dy = -player.jumpPower;
  }
}

// /**/ Draw everything
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // /**/ Draw floor normally, scaled and repeated
  const floorScale = floorHeight / floorImg.height;
  const floorWidthScaled = floorImg.width * floorScale;
  for(let i=0; i<Math.ceil(canvas.width / floorWidthScaled); i++){
    ctx.drawImage(floorImg, i*floorWidthScaled, canvas.height-floorHeight, floorWidthScaled, floorHeight);
  }

  // /**/ Draw stairs
  for(const s of stairs){
    ctx.drawImage(stairImg, s.x, s.y, s.width, s.height);
  }

  // /**/ Draw player (cat emoji)
  ctx.font = "32px Arial";
  ctx.fillText("ðŸ±", player.x, player.y + player.height);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

floorImg.onload = () => {
  stairImg.onload = () => {
    loop();
  }
};
</script>
</body>
</html>