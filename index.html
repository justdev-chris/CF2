<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  canvas {
    background: #87CEEB;
    display: block;
    margin: 0 auto;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
// /**/ Rawr~ lil catboy code 🐾

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const tileSize = 64; // size to scale floor and stairs
const floorImg = new Image();
floorImg.src = "floor.png"; // 512x127 original
const stairImg = new Image();
stairImg.src = "stairs.png"; // 40x32 original

const player = {
  x: 100,
  y: 0,
  width: 32,
  height: 32,
  vy: 0,
  onGround: false,
  speed: 3,
};

let keys = {};
let shiftHeld = false;

// /**/ Floors and stairs
const floors = [{x:0, y: 350, width: 800, height: tileSize}]; 
const stairs = [
  {x: 200, y: 318, width: tileSize, height: 32},
  {x: 232, y: 286, width: tileSize, height: 32},
  {x: 264, y: 254, width: tileSize, height: 32},
];

document.addEventListener("keydown", e => {
  keys[e.key] = true;
  if(e.key === "Shift") shiftHeld = true;
});
document.addEventListener("keyup", e => {
  keys[e.key] = false;
  if(e.key === "Shift") shiftHeld = false;
});

function gameLoop() {
  // /**/ Clear
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // /**/ Draw floor
  for(let i=0;i<floors[0].width;i+=tileSize){
    ctx.drawImage(floorImg, i, floors[0].y, tileSize, tileSize);
  }

  // /**/ Draw stairs
  stairs.forEach(stair => {
    ctx.drawImage(stairImg, stair.x, stair.y, stair.width, stair.height);
  });

  // /**/ Player physics
  player.vy += 0.5; // gravity
  player.y += player.vy;

  player.onGround = false;

  // /**/ Floor collision
  floors.forEach(floor => {
    if(player.y + player.height > floor.y && player.x + player.width > floor.x && player.x < floor.x + floor.width) {
      player.y = floor.y - player.height;
      player.vy = 0;
      player.onGround = true;
    }
  });

  // /**/ Stairs collision
  stairs.forEach(stair => {
    if(!shiftHeld &&
       player.x + player.width > stair.x && 
       player.x < stair.x + stair.width && 
       player.y + player.height > stair.y && 
       player.y < stair.y + stair.height) {
      player.y = stair.y - player.height;
      player.vy = 0;
      player.onGround = true;
    }
  });

  // /**/ Player movement
  if(keys["ArrowLeft"]) player.x -= player.speed;
  if(keys["ArrowRight"]) player.x += player.speed;
  if(keys["ArrowUp"] && player.onGround) player.vy = -10;

  // /**/ Draw player (cat emoji)
  ctx.font = player.width + "px Arial";
  ctx.fillText("🐱", player.x, player.y + player.height);

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>