<!-- Cat Fortress 2: Fixed Floor and Stairs -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cat Fortress 2</title>
<style>
  canvas {
    background: #a0d8f0;
    display: block;
    margin: 0 auto;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
/** Cat Fortress 2 - lil catboy version 🐾 **/

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// --- Images ---
const floorImg = new Image();
floorImg.src = 'floor.png'; // 512x127
const stairImg = new Image();
stairImg.src = 'stairs.png'; // 40x32

// --- Player ---
const player = {
    x: 50,
    y: 300,
    width: 32,
    height: 32,
    vy: 0,
    speed: 3,
    jumping: false
};

// --- Keys ---
const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// --- Floor ---
const floor = {
    x: 0,
    y: 350,
    width: canvas.width,
    height: 32
};

// --- Stairs (manual positions) ---
const stairs = [
    {x: 200, y: 318, width: 40, height: 32},
    {x: 240, y: 286, width: 40, height: 32},
    {x: 280, y: 254, width: 40, height: 32} // top stair
];

// --- Gravity ---
const gravity = 0.7;

// --- Game Loop ---
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // --- Floor drawing ---
    const floorRepeat = Math.ceil(floor.width / floorImg.width);
    for (let i = 0; i < floorRepeat; i++) {
        ctx.drawImage(floorImg, i * floorImg.width, floor.y, floorImg.width, floor.height);
    }

    // --- Stairs drawing ---
    stairs.forEach(stair => {
        ctx.drawImage(stairImg, stair.x, stair.y, stair.width, stair.height);
    });

    // --- Player movement ---
    if (keys['arrowleft'] || keys['a']) player.x -= player.speed;
    if (keys['arrowright'] || keys['d']) player.x += player.speed;
    if ((keys['arrowup'] || keys['w']) && !player.jumping) {
        player.vy = -12;
        player.jumping = true;
    }

    // --- Gravity ---
    player.vy += gravity;
    player.y += player.vy;

    // --- Collision with floor ---
    if (player.y + player.height > floor.y && !(keys['shift'])) {
        player.y = floor.y - player.height;
        player.vy = 0;
        player.jumping = false;
    }

    // --- Collision with stairs ---
    stairs.forEach(stair => {
        if (!keys['shift'] &&
            player.x + player.width > stair.x &&
            player.x < stair.x + stair.width &&
            player.y + player.height > stair.y &&
            player.y < stair.y + stair.height
        ) {
            player.y = stair.y - player.height;
            player.vy = 0;
            player.jumping = false;
        }
    });

    // --- Draw player ---
    ctx.font = `${player.height}px Arial`;
    ctx.fillText('🐱', player.x, player.y + player.height);

    requestAnimationFrame(gameLoop);
}

// Start the loop once images are loaded
floorImg.onload = () => stairImg.onload = gameLoop;

</script>
</body>
</html>