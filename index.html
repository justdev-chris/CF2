<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2 🐱</title>
<style>
  canvas {
    border:1px solid #000;
    display:block;
    margin:0 auto;
    background:#a0d8f1;
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
/**/ const canvas = document.getElementById('gameCanvas');
/**/ const ctx = canvas.getContext('2d');

/**/ // Player 🐱
/**/ const player = {
  x: 50,
  y: canvas.height - 127 - 32,
  width: 32,
  height: 32,
  vy:0,
  speed:3,
  jumpPower:8,
  onGround:false
};

/**/ // Floor
/**/ const floor = {x:0, y:canvas.height-127, width:512, height:127};

/**/ // Stairs 40x32, connected to floor
/**/ const stairs = [
  {x:300, y:canvas.height-127-32, width:40, height:32},
  {x:340, y:canvas.height-127-64, width:40, height:32},
  {x:380, y:canvas.height-127-96, width:40, height:32}
];

/**/ // Input
/**/ const keys = {};
/**/ document.addEventListener('keydown', e => keys[e.code]=true);
/**/ document.addEventListener('keyup', e => keys[e.code]=false);

/**/ function update() {
  // Horizontal movement
  if(keys['ArrowLeft'] || keys['KeyA']) player.x -= player.speed;
  if(keys['ArrowRight'] || keys['KeyD']) player.x += player.speed;

  // Gravity
  player.vy += 0.5;
  player.y += player.vy;
  player.onGround=false;

  // Floor collision
  if(player.y + player.height > floor.y) {
    player.y = floor.y - player.height;
    player.vy=0;
    player.onGround=true;
  }

  // Stairs collision
  stairs.forEach(s=>{
    if(player.x + player.width > s.x && player.x < s.x + s.width &&
       player.y + player.height > s.y && player.y + player.height < s.y + s.height + player.vy) {
      player.y = s.y - player.height;
      player.vy=0;
      player.onGround=true;
    }
  });

  // Jump
  if((keys['ArrowUp'] || keys['KeyW'] || keys['Space']) && player.onGround){
    player.vy=-player.jumpPower;
  }
}

/**/ function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw floor
  ctx.fillStyle='#654321';
  ctx.fillRect(floor.x,floor.y,floor.width,floor.height);

  // Draw stairs
  ctx.fillStyle='#a0522d';
  stairs.forEach(s=> ctx.fillRect(s.x,s.y,s.width,s.height));

  // Draw player 🐱
  ctx.font = player.height+'px serif';
  ctx.fillText('🐱', player.x, player.y + player.height);
}

/**/ function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

/**/ gameLoop();
</script>
</body>
</html>