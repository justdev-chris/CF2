<!-- Cat Fortress 2 - lil catboy edition 🐾 -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #87ceeb;
  }
  canvas {
    display: block;
    background: #87ceeb;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>

<script>
// /**/ lil catboy rawr~ 🥺
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

canvas.width = 800;
canvas.height = 400;

// Load images
const floorImg = new Image();
floorImg.src = 'floor.png'; // 512x127
const stairsImg = new Image();
stairsImg.src = 'stairs.png'; // 40x32

// Player
const player = {
  x: 50,
  y: 300,
  width: 32,
  height: 32,
  dy: 0,
  gravity: 0.8,
  jumpPower: -12,
  onGround: false,
  symbol: '🐱'
};

// Controls
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// Tiles setup
const floorTiles = [];
const stairs = [];

// Floor repeated across bottom
for (let i = 0; i < Math.ceil(canvas.width / floorImg.width) + 1; i++) {
  floorTiles.push({x: i * floorImg.width, y: canvas.height - floorImg.height});
}

// Stairs positions
stairs.push({x: 300, y: canvas.height - floorImg.height - stairsImg.height});
stairs.push({x: 340, y: canvas.height - floorImg.height - stairsImg.height*2});
stairs.push({x: 380, y: canvas.height - floorImg.height - stairsImg.height*3});

// Collision detection
function checkCollision(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

// Game loop
function gameLoop() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Draw floor
  floorTiles.forEach(tile => {
    ctx.drawImage(floorImg, tile.x, tile.y, floorImg.width, floorImg.height);
  });

  // Draw stairs
  stairs.forEach(stair => {
    ctx.drawImage(stairsImg, stair.x, stair.y, stairsImg.width, stairsImg.height);
  });

  // Player movement
  if (keys['ArrowLeft']) player.x -= 5;
  if (keys['ArrowRight']) player.x += 5;
  if (keys['ArrowUp'] && player.onGround) {
    player.dy = player.jumpPower;
    player.onGround = false;
  }

  // Gravity
  player.dy += player.gravity;
  player.y += player.dy;

  // Check collision with floor
  player.onGround = false;
  floorTiles.forEach(tile => {
    if (checkCollision(player, {x: tile.x, y: tile.y, width: floorImg.width, height: floorImg.height})) {
      player.y = tile.y - player.height;
      player.dy = 0;
      player.onGround = true;
    }
  });

  // Check collision with stairs
  stairs.forEach(stair => {
    if (checkCollision(player, {x: stair.x, y: stair.y, width: stairsImg.width, height: stairsImg.height})) {
      if (player.dy >= 0) { // landing on top
        player.y = stair.y - player.height;
        player.dy = 0;
        player.onGround = true;
      }
    }
  });

  // Draw player
  ctx.font = `${player.height}px sans-serif`;
  ctx.fillText(player.symbol, player.x, player.y + player.height);

  requestAnimationFrame(gameLoop);
}

//  start loop when images loaded
floorImg.onload = () => {
  stairsImg.onload = () => {
    gameLoop();
  }
};
</script>
</body>
</html>