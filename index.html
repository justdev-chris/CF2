<!-- Cat Fortress 2 - lil catboy edition üêæ -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Cat Fortress 2</title>
<style>
  body { margin:0; overflow:hidden; background:#b3e5fc; }
  canvas { display:block; background:#b3e5fc; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
/**/ const canvas = document.getElementById("game");
/**/ const ctx = canvas.getContext("2d");
/**/ canvas.width = window.innerWidth;
/**/ canvas.height = window.innerHeight;

/**/ const floorImg = new Image();
/**/ floorImg.src = "floor.png"; // your 512x127 floor tile
/**/ const stairsImg = new Image();
/**/ stairsImg.src = "stairs.png"; // stairs tile

/**/ const gravity = 0.7;

/**/ const player = {
  x: 100,
  y: 0,
  width: 32,
  height: 32,
  vy: 0,
  onGround: false
};

/**/ const keys = {};

/**/ const floorTiles = [
  {x:0, y:canvas.height-127, width:512, height:127},
  {x:512, y:canvas.height-127, width:512, height:127}
];

/**/ const stairs = [
  {x:300, y:canvas.height-127-32, width:64, height:32},
  {x:364, y:canvas.height-127-64, width:64, height:32},
  {x:428, y:canvas.height-127-96, width:64, height:32}
];

/**/ window.addEventListener("keydown", e => keys[e.key] = true);
/**/ window.addEventListener("keyup", e => keys[e.key] = false);

function drawFloor() {
  for (let f of floorTiles) ctx.drawImage(floorImg, f.x, f.y, f.width, f.height);
}

function drawStairs() {
  for (let s of stairs) ctx.drawImage(stairsImg, s.x, s.y, s.width, s.height);
}

function drawPlayer() {
  ctx.fillText("üê±", player.x, player.y + player.height);
}

function checkCollision(rects) {
  player.onGround = false;
  for (let r of rects) {
    if (player.x < r.x + r.width &&
        player.x + player.width > r.x &&
        player.y + player.height < r.y + r.height &&
        player.y + player.height + player.vy >= r.y) {
      player.vy = 0;
      player.y = r.y - player.height;
      player.onGround = true;
    }
  }
}

function update() {
  // horizontal movement
  if (keys["ArrowLeft"] || keys["a"]) player.x -= 5;
  if (keys["ArrowRight"] || keys["d"]) player.x += 5;
  
  // jump
  if ((keys["ArrowUp"] || keys["w"]) && player.onGround) {
    player.vy = -15;
    player.onGround = false;
  }

  // gravity
  player.vy += gravity;
  player.y += player.vy;

  // collision
  checkCollision([...floorTiles, ...stairs]);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawFloor();
  drawStairs();
  drawPlayer();
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

/**/ loop();
</script>
</body>
</html>